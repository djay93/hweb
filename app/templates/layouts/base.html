<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
	<meta http-equiv="X-UA-Compatible" content="ie=edge"/>

    <title>{% block title %}ReguTrack - Compliance Hub{% endblock %}</title>

    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="mobile-web-app-capable" content="yes"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="MobileOptimized" content="320"/>
    <meta name="title" content="ReguTrack - Compliance Hub">
    <meta name="description" content="ReguTrack is a centralized automation hub for the Enterprise compliance team.">
    <meta name="author" content="ECAD">
    <link rel="icon" href="/static/icons/favicon.ico" type="image/x-icon"/>
	<link rel="shortcut icon" href="/static/icons/favicon.ico" type="image/x-icon"/>

    <meta name="csrf-token" content="{{ csrf_token() }}">
    
    <!-- Tabler CSS -->
    <link href="{{ url_for('static', filename='css/tabler.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">

    <!--Alpine JS-->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

    <!-- JSON Editor -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/10.1.0/jsoneditor.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/10.1.0/jsoneditor.min.js"></script>
</head>
<body>
    <div class="page">
        {% include 'layouts/navbar.html' %}
        {% include 'layouts/navbar-menu.html' %}
        <div class="page-wrapper">
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <h2 class="page-title">
                                {% block page_title %}{% endblock %}
                            </h2>
                        </div>
                        <div class="col-auto ms-auto d-print-none">
                            <div class="btn-list">
                                {% block page_actions %}{% endblock %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <main class="page-body">
                <div class="container-xl">
                    <!-- Toast Container -->
                    <div class="toast-container position-fixed top-0 end-0 p-3" x-data="toastManager()" style="z-index: 1055">
                        <template x-for="toast in toasts" :key="toast.id">
                            <div class="toast show shadow-lg border-0"
                                 x-show.transition.opacity.duration.500ms="toast.show"
                                 role="alert" aria-live="assertive" aria-atomic="true"
                                 style="min-width: 300px;">
                                <div class="toast-header" :class="{
                                    'bg-success-subtle text-success': toast.type === 'success',
                                    'bg-danger-subtle text-danger': toast.type === 'error',
                                    'bg-info-subtle text-info': toast.type === 'info'
                                }">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <path x-show="toast.type === 'success'" d="M5 12l5 5l10 -10" />
                                        <path x-show="toast.type === 'error'" d="M18 6l-12 12m0 -12l12 12" />
                                        <path x-show="toast.type === 'info'" d="M12 2a10 10 0 1 0 0 20a10 10 0 0 0 0 -20z M12 8h.01 M11 12h1v4h1" />
                                    </svg>
                                    <strong class="me-auto" x-text="toast.type === 'success' ? 'Success' : (toast.type === 'error' ? 'Error' : 'Info')"></strong>
                                    <button type="button" class="btn-close" :class="{
                                        'text-success': toast.type === 'success',
                                        'text-danger': toast.type === 'error',
                                        'text-info': toast.type === 'info'
                                    }" @click="removeToast(toast.id)" aria-label="Close"></button>
                                </div>
                                <div class="toast-body" :class="{
                                    'bg-white text-success': toast.type === 'success',
                                    'bg-white text-danger': toast.type === 'error',
                                    'bg-white text-info': toast.type === 'info'
                                }" x-text="toast.message"></div>
                            </div>
                        </template>
                    </div>
                    <!--nav class="mb-3" aria-label="breadcrumb">
                        {% block breadcrumb %}
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item">
                                    <a href="{{ url_for('user.dashboard') }}">
                                        <svg class="icon" xmlns="http://www.w3.org/2000/svg">
                                            <use href="{{ url_for('static', filename='icons/home.svg') }}#home"/>
                                        </svg>
                                    </a>
                                </li>
                                <li class="breadcrumb-item active" aria-current="page">{% block meta_title %}{% endblock %}</li>
                            </ol>
                        {% endblock %}
                    </nav-->

                    {% block content %}{% endblock %}
                </div>
            </main>

            {% include 'layouts/footer.html' %}
        </div>
    </div>
    
    <!-- Tabler JS -->
    <script src="{{ url_for('static', filename='js/tabler.min.js') }}"></script>
    <script>
        function toastManager() {
            return {
                toasts: [],
                addToast(type, message) {
                    if (typeof message !== 'string' || message.trim() === '') {
                        return;
                    }
                    
                    const id = Date.now();
                    // Limit to 3 toasts
                    if (this.toasts.length >= 3) {
                        this.toasts.shift(); 
                    }
                    this.toasts.push({ id, type, message, show: true });

                    // Auto-hide after 4 seconds
                    setTimeout(() => this.removeToast(id), 4000);
                },
                removeToast(id) {
                    this.toasts = this.toasts.filter(toast => toast.id !== id);
                }
            };
        }

        window.showToast = (type, message) => {
            const toastContainer = document.querySelector('[x-data="toastManager()"]');
            if (toastContainer) {
                const toastManager = Alpine.$data(toastContainer);
                toastManager.addToast(type, message);
            }
        };
    </script>
    {% block scripts %}{% endblock %}

</body>
</html>
